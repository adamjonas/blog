
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>learn sql the hard way - Hack hack hack...</title>
  <meta name="author" content="Adam Jonas">

  
  <meta name="description" content="Schema: 1
2
3
4
5
6
7
8
9
10
11
♕ sqlite3 ex3.db .schema
/* OR */
♕ sqlite3 ex3.db
SQLite version 3.7.7 2011-06-25 16:35:1
Enter ".help" for &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="bPr3kB-X2beP1o9InhOKH9ci-gljU3a7NLEeap4urfc" />

  
  <link rel="canonical" href="http://adamjonas.com/blog/learn-sql-the-hard-way/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Hack hack hack..." type="application/atom+xml">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
 <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-35486864-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <div id="logo">
  	<div id="logoLeft">{</div>
  	<div id="logoText">Adam Jonas</div>
  	<div id="logoRight">}</div>
  	<div class="clear"></div>
  </div>
  <h1><a href="/">Hack hack hack...</a></h1>
  
    <h2>An open journal-- some of it written for you, but most of it is for me.</h2>
  
  <div class="clear"></div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:adamjonas.com" />
    <input class="search" type="text" name="q" results="100" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about">About</a></li>
  <li><a href="/glossary">Glossary</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      
        <h1 class="entry-title">Learn Sql the Hard Way</h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2012-09-26T12:53:00-04:00" pubdate data-updated="true">Sep 26<span>th</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Schema:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>♕ sqlite3 ex3.db .schema
</span><span class='line'>/* OR */
</span><span class='line'>♕ sqlite3 ex3.db
</span><span class='line'>SQLite version 3.7.7 2011-06-25 16:35:1
</span><span class='line'>Enter ".help" for instructions
</span><span class='line'>Enter SQL statements terminated with a ";"
</span><span class='line'>sqlite&gt; .schema
</span><span class='line'>CREATE TABLE person (
</span><span class='line'>  id INTEGER PRIMARY KEY,
</span><span class='line'>  first_name TEXT,
</span><span class='line'>  last_name TEXT,</span></code></pre></td></tr></table></div></figure>


<p>In the first line I just make ex3.db from the ex2.sql file. Then I add the -echo argument to sqlite3 so that it prints out what it is doing. After that the data is in the database and ready to query.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sqlite3 ex3.db &lt; ex2.sql
</span><span class='line'>$ sqlite3 -echo ex3.db &lt; ex3.sql 
</span><span class='line'>INSERT INTO person (id, first_name, last_name, age)
</span><span class='line'>    VALUES (0, "Zed", "Shaw", 37);
</span><span class='line'>INSERT INTO pet (id, name, breed, age, dead) 
</span><span class='line'>    VALUES (0, "Fluffy", "Unicorn", 1000, 0); 
</span><span class='line'>INSERT INTO pet VALUES (1, "Gigantor", "Robot", 1, 1);</span></code></pre></td></tr></table></div></figure>


<p><strong>Important</strong>
Always remember this: SQL ONLY KNOWS TABLES. In programming you deal in graphs and in SQL you deal in tables. They&#8217;re related concepts, but the mental model is different.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/* I only want some columns from pet so I am explicit rather than using the '*' */
</span><span class='line'>SELECT pet.id, pet.name, pet.age, pet.dead
</span><span class='line'>/* To connect person and pet I use the person_pet JOIN table */
</span><span class='line'>  FROM pet, person_pet, person
</span><span class='line'>  WHERE
</span><span class='line'>      #connect person and pet by the related id columns
</span><span class='line'>      #now the DB can search for only the rows where the ID columns all match
</span><span class='line'>  pet.id = person_pet.pet_id AND
</span><span class='line'>      #connect person and person_pet in the same way
</span><span class='line'>  person_pet.person.id = person.id AND
</span><span class='line'>      #ask for only the pets that I own
</span><span class='line'>  person.first_name = "Adam";</span></code></pre></td></tr></table></div></figure>


<p><strong>Delete</strong>
DELETE is like SELECT but it removes rows from the table.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>DELETE FROM pet WHERE id IN (
</span><span class='line'>  SELECT pet.id
</span><span class='line'>  FROM pet, person_pet, person
</span><span class='line'>  WHERE
</span><span class='line'>  person.id = person_pet.person_id AND
</span><span class='line'>  pet.id = person_pet.pet.id AND
</span><span class='line'>  person.first_name = "Zed"
</span><span class='line'>);
</span><span class='line'>
</span><span class='line'>  SELECT * FROM pet; 
</span><span class='line'>  SELECT * FROM person_pet;
</span><span class='line'>  
</span><span class='line'>  DELETE FROM person_pet
</span><span class='line'>      WHERE pet_id NOT IN ( 
</span><span class='line'>          SELECT id FROM pet
</span><span class='line'>      );
</span><span class='line'>  
</span><span class='line'>  SELECT * FROM person_pet;</span></code></pre></td></tr></table></div></figure>


<p>The WHERE clause uses an IN to match the id columns in pet to the table that&#8217;s returned in the subquery. The subquery (also called a subselect) is then a normal SELECT.</p>

<p>How SQL does this is with the following process:
1. Runs the subquery in the parenthesis at the end and build a table with all the columns just like a normal SELECT.
2. Treats this table as a kind of temporary table to match pet.id columns against.
3. Goes through the pet table and deletes any row that has an id IN this temporary table.</p>

<p><em>REPLACE</em></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/* We can force it by doing an INSERT OR REPLACE. */ 
</span><span class='line'>INSERT OR REPLACE INTO person (id, first_name, last_name, age) 
</span><span class='line'>    VALUES (0, 'Frank', 'Smith', 100);
</span><span class='line'>
</span><span class='line'>SELECT * FROM person; 
</span><span class='line'>
</span><span class='line'>/* And shorthand for that is just REPLACE. */ 
</span><span class='line'>REPLACE INTO person (id, first_name, last_name, age) 
</span><span class='line'>    VALUES (0, 'Zed', 'Shaw', 37);</span></code></pre></td></tr></table></div></figure>


<p><em>DROP TABLE</em></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  /* Only drop table if it exists. Use the IF EXISTS modifier and the table will be dropped only if it's already there. This suppresses the error you get when running you .sql script on a fresh database that has no tables. */
</span><span class='line'> DROP TABLE IF EXISTS person;
</span><span class='line'>   
</span><span class='line'>  /* Create again to work with it. */
</span><span class='line'>  CREATE TABLE person ( 
</span><span class='line'>      id INTEGER PRIMARY KEY,
</span><span class='line'>      first_name TEXT,
</span><span class='line'>      last_name TEXT, 
</span><span class='line'>      age INTEGER
</span><span class='line'>  );
</span><span class='line'>   
</span><span class='line'>  /* Rename the table to peoples. */ 
</span><span class='line'>  ALTER TABLE person RENAME TO peoples;
</span><span class='line'>   
</span><span class='line'>  /* Add a hatred column to peoples. */ 
</span><span class='line'>  ALTER TABLE peoples ADD COLUMN hatred INTEGER;
</span><span class='line'>     
</span><span class='line'>  /* Rename peoples back to person. */
</span><span class='line'>  ALTER TABLE peoples RENAME TO person; 
</span><span class='line'>  
</span><span class='line'>  .schema person
</span><span class='line'> 
</span><span class='line'>  /* We don't need that. */
</span><span class='line'>  DROP TABLE person;</span></code></pre></td></tr></table></div></figure>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Adam Jonas</span></span>

      








  


<time datetime="2012-09-26T12:53:00-04:00" pubdate data-updated="true">Sep 26<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/sql/'>SQL</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left articlenav" href="/blog/rspec/" title="Previous Post: RSpec">&laquo; RSpec</a>
      
      
        <a class="basic-alignment right articlenav" href="/blog/ruby-rogue-notes/" title="Next Post: ruby rogue notes">ruby rogue notes &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/elastic-search/">Elastic Search</a>
      </li>
    
      <li class="post">
        <a href="/blog/preparing-data-for-machine-learning/">Preparing Data for Machine Learning</a>
      </li>
    
      <li class="post">
        <a href="/blog/the-soul-in-the-machine-developing-for-humans/">The Soul in The Machine - Developing for Humans</a>
      </li>
    
      <li class="post">
        <a href="/blog/intro-to-dns/">Intro to DNS</a>
      </li>
    
      <li class="post">
        <a href="/blog/7-righteous-fights/">7 righteous fights</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - Adam Jonas -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'ajonas';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://adamjonas.com/blog/learn-sql-the-hard-way/';
        var disqus_url = 'http://adamjonas.com/blog/learn-sql-the-hard-way/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
