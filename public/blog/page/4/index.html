
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Hack hack hack...</title>
  <meta name="author" content="Adam Jonas">

  
  <meta name="description" content="Polymorphic association from parent to child So this succinctly summed up my issue. Deprecated conditions in rails 4 Deprecation warning when using &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="bPr3kB-X2beP1o9InhOKH9ci-gljU3a7NLEeap4urfc" />

  
  <link rel="canonical" href="http://adamjonas.com/blog/page/4/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Hack hack hack..." type="application/atom+xml">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
 <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-35486864-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <div id="logo">
  	<div id="logoLeft">{</div>
  	<div id="logoText">Adam Jonas</div>
  	<div id="logoRight">}</div>
  	<div class="clear"></div>
  </div>
  <h1><a href="/">Hack hack hack...</a></h1>
  
    <h2>An open journal-- some of it written for you, but most of it is for me.</h2>
  
  <div class="clear"></div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:adamjonas.com" />
    <input class="search" type="text" name="q" results="100" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about">About</a></li>
  <li><a href="/glossary">Glossary</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/polymorphic-brain-hurt/">Polymorphic Brain Hurt</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2014-08-21T17:38:00-04:00" pubdate data-updated="true">Aug 21<span>st</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Polymorphic association from parent to child</h2>

<p>So <a href="http://blog.hasmanythrough.com/2006/4/3/polymorphic-through">this</a> succinctly summed up my issue.</p>

<h2>Deprecated conditions in rails 4</h2>

<p><code>Deprecation warning when using has_many :through :uniq in Rails 4</code></p>

<p>Then once I did get it working with:</p>

<figure class='code'><figcaption><span>Conditions Refactor</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># lesson model</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:readmes</span><span class="p">,</span> <span class="ss">:through</span> <span class="o">=&gt;</span> <span class="ss">:lesson_contents</span><span class="p">,</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="ss">:readme</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">:conditions</span> <span class="o">=&gt;</span> <span class="s2">&quot;lesson_contents.content_type = &#39;Readme&#39;&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:labs</span><span class="p">,</span> <span class="ss">:through</span> <span class="o">=&gt;</span> <span class="ss">:lesson_contents</span><span class="p">,</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="ss">:lab</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">:conditions</span> <span class="o">=&gt;</span> <span class="s2">&quot;lesson_contents.content_type = &#39;Lab&#39;&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># stabby lambda</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:readmes</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="s2">&quot;content_type = &#39;Readme&#39;&quot;</span><span class="p">)</span> <span class="p">},</span>
</span><span class='line'>    <span class="ss">:through</span> <span class="o">=&gt;</span> <span class="ss">:lesson_contents</span><span class="p">,</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="ss">:readme</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:labs</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="s2">&quot;content_type = &#39;Lab&#39;&quot;</span><span class="p">)</span> <span class="p">},</span> <span class="ss">:through</span> <span class="o">=&gt;</span>
</span><span class='line'>    <span class="ss">:lesson_contents</span><span class="p">,</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="ss">:lab</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://stackoverflow.com/a/16702101/1496757">Hat Tip</a></p>

<h2>Polymorphic Migration</h2>

<figure class='code'><figcaption><span>Creating a [polymorphic migration](http://stackoverflow.com/a/5534614/1496757)</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">AddImageableToProducts</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">up</span>
</span><span class='line'>    <span class="n">change_table</span> <span class="ss">:products</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">references</span> <span class="ss">:imageable</span><span class="p">,</span> <span class="ss">:polymorphic</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/vim-shortcuts/">VIM Shortcuts</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2014-08-05T10:53:00-04:00" pubdate data-updated="true">Aug 5<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>File Search</h3>

<ul>
<li>cntl + p => file search</li>
</ul>


<h3>Nerd Tree</h3>

<ul>
<li><code>go</code> => preview pane</li>
</ul>


<h3>Run the specs</h3>

<ul>
<li><code>\r</code> runs the closest spec</li>
<li><code>\R</code> runs the whole spec suite</li>
</ul>


<h3>cmd + shift + d</h3>

<ul>
<li><code>control + n</code></li>
</ul>


<h3>vimium for life</h3>

<ul>
<li><code>\\f</code> + character you are looking for</li>
<li><code>\\w</code> + word</li>
<li><code>\\e</code> goes to end of words</li>
<li>you get it</li>
</ul>


<h3>Go to line</h3>

<ul>
<li><code>line number + G</code></li>
</ul>


<h3>Tab in or out</h3>

<ul>
<li><code>&gt;&gt;</code> &amp; <code>&lt;&lt;</code></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/expect/">Expect</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2014-07-30T11:11:00-04:00" pubdate data-updated="true">Jul 30<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Intro commands</h3>

<ul>
<li><a href="ftp://ftp.sunet.se/pub/lang/tcl/expect/doc/90min-intro-talk.pdf">summary of commands</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/strace/">Strace</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2014-07-25T13:04:00-04:00" pubdate data-updated="true">Jul 25<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Start here:</h3>

<ul>
<li>Greg Price’s excellent blog post <a href="https://blogs.oracle.com/ksplice/entry/strace_the_sysadmin_s_microscope">Strace – The Sysadmin’s Microscope</a>.</li>
<li><a href="http://jvns.ca/blog/categories/strace/">Julia Evans</a> has a lot too.</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/intro-to-docker/">Intro to Docker</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2014-07-25T12:49:00-04:00" pubdate data-updated="true">Jul 25<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Docker API</h3>

<ul>
<li><a href="https://github.com/swipely/docker-api">Checkout</a></li>
</ul>


<h3>Relevant Docker Images</h3>

<ul>
<li><a href="https://github.com/progrium/dokku">dokku</a></li>
</ul>


<h3>Pups</h3>

<ul>
<li><a href="https://github.com/samsaffron/pups">pups</a> is a small library that allows you to automate the process of creating Unix images</li>
</ul>


<h3>Deployments</h3>

<ul>
<li><a href="https://coreos.com/">Core OS</a></li>
</ul>


<h3>Discourse on docker</h3>

<ul>
<li><a href="http://samsaffron.com/archive/2013/11/07/discourse-in-a-docker-container">Sam Saffron explains</a></li>
</ul>


<h3>haproxy</h3>

<ul>
<li><a href="http://www.haproxy.org/">High Performance Load Balancer</a></li>
</ul>


<h3>Testing</h3>

<ul>
<li>testing docker seems tough. Puppet Labs <a href="https://github.com/puppetlabs/beaker/blob/master/spec/beaker/hypervisor/docker_spec.rb">gave it a run</a>.</li>
</ul>


<h3>Intro video</h3>

<ul>
<li><a href="https://www.youtube.com/watch?v=Q5POuMHxW-0">Founder of Docker Inc</a></li>
</ul>


<h3>Commands</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>docker run -p 3000:3000 -t -i dockerregistry.flatironschool.com/ironboard /bin/bash
</span><span class='line'>source /etc/profile.d/rvm.sh 
</span><span class='line'>rvm reload
</span><span class='line'>vi ironboard/config/database.yml
</span><span class='line'>cd ironboard/
</span><span class='line'>service postgresql start
</span><span class='line'>rake db:migrate
</span><span class='line'>
</span><span class='line'>docker build -t dockerregistry.flatironschool.com/ironboard .
</span><span class='line'>docker run -d -p 3000:3000 dockerregistry.flatironschool.com/ironboard</span></code></pre></td></tr></table></div></figure>


<h3>Notes from <a href="http://vimeo.com/95932458">Docker: The Revolution Will Be Containerized</a></h3>

<ul>
<li>Containers are just other Linux processes on the host not virtualized calls</li>
<li>The only performance decrease you see is Linux asking whether it is allowed to access this file - share a kernel with the host</li>
<li><p>Not nested virtualization</p>

<ul>
<li>this would be slow</li>
<li>no device emulation, which makes it faster</li>
</ul>
</li>
<li><p>Can be used as a light weight vm but that&#8217;s not the only way</p></li>
<li><p><strong><code>Chroot</code> on steroids?</strong></p>

<ul>
<li><p>(From <a href="http://en.wikipedia.org/wiki/Chroot">Wikipedia</a>) A <code>chroot</code> on Unix operating systems is an operation that changes the apparent root directory for the current running process and its children.</p></li>
<li><p>A chroot environment can be used to create and host a separate virtualized copy of the software system. This can be useful for:</p>

<ul>
<li><p><strong>Testing and development</strong></p>

<ul>
<li>A test environment can be set up in the chroot for software that would otherwise be too risky to deploy on a production system.</li>
</ul>
</li>
<li><p><strong>Dependency control</strong></p>

<ul>
<li>Software can be developed, built and tested in a chroot populated only with its expected dependencies. This can prevent some kinds of linkage skew that can result from developers building projects with different sets of program libraries installed.</li>
</ul>
</li>
<li><p><strong>Compatibility</strong></p>

<ul>
<li>Legacy software or software using a different <a href="http://en.wikipedia.org/wiki/Application_binary_interface">application binary interface</a> must sometimes be run in a chroot because their supporting libraries or data files may otherwise clash in name or linkage with those of the host system.</li>
</ul>
</li>
<li><p><strong>Recovery</strong></p>

<ul>
<li>Should a system be rendered unbootable, a chroot can be used to move back into the damaged environment after bootstrapping from an alternate root file system (such as from installation media, or a Live CD).</li>
</ul>
</li>
<li><p><strong>Privilege separation</strong></p>

<ul>
<li>Programs are allowed to carry open file descriptors (for files, pipelines and network connections) into the chroot, which can simplify jail design by making it unnecessary to leave working files inside the chroot directory. This also simplifies the common arrangement of running the potentially vulnerable parts of a privileged program in a sandbox, in order to pre-emptively contain a security breach. Note that chroot is not necessarily enough to contain a process with root privileges.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Cgroups</strong></p>

<ul>
<li><a href="http://en.wikipedia.org/wiki/Cgroups">Cgroups</a>)is a Linux kernel feature to limit, account, and isolate resource usage (CPU, memory, disk I/O, etc.) of process groups.</li>
<li>Cgroups also provides namespace isolation to completely isolate application&#8217;s view of the operating environment, including process trees, network, user ids and mounted file systems.</li>
</ul>
</li>
<li><p><strong>LXC (LinuX Containers)</strong></p>

<ul>
<li><a href="http://en.wikipedia.org/wiki/LXC">LXC</a> provides operating system-level virtualization through a virtual environment that has its own process and network space, instead of creating a full-fledged virtual machine.</li>
<li>The Linux kernel comprises cgroups for resource isolation (CPU, memory, block I/O, network, etc.) that does not require starting any virtual machines.</li>
<li>LXC combines cgroups and namespace support to provide an isolated environment for applications. Docker can also use LXC as one of its execution drivers, enabling image management and providing deployment services.</li>
</ul>
</li>
<li><p><strong>CoreOS</strong></p>

<ul>
<li><a href="http://en.wikipedia.org/wiki/CoreOS">CoreOS</a> is an open source lightweight operating system based on the Linux kernel and designed for providing infrastructure to clustered deployments, while focusing on automation, ease of applications deployment, security, reliability and scalability. As an operating system, CoreOS provides only the minimal functionality required for deploying applications inside software containers, together with built-in mechanisms for service discovery and configuration sharing.</li>
</ul>
</li>
</ul>


<h3>Linking Multiple Apps</h3>

<ul>
<li></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/testing-with-logan/">Testing With Logan</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2014-07-25T12:37:00-04:00" pubdate data-updated="true">Jul 25<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Receive Message Chain</h3>

<ul>
<li>In lieu of the depreciated <code>stub_chain</code> there is now <a href="https://github.com/rspec/rspec-mocks/pull/467"><code>receive_message_chain</code></a>.</li>
</ul>


<figure class='code'><figcaption><span>receive_message_chain</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">allow</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">receive_message_chain</span><span class="p">(</span><span class="ss">:foo</span><span class="p">,</span> <span class="ss">:bar</span><span class="p">)</span><span class="o">.</span><span class="n">and_return</span><span class="p">(</span><span class="n">double</span><span class="p">)</span>
</span><span class='line'><span class="n">expect</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">bar</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:bazz</span><span class="p">)</span><span class="o">.</span><span class="n">with</span><span class="p">(</span><span class="sr">/adfads/</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Yielding multiple variables</h3>

<ul>
<li><code>allow(fake_container).to receive(:attach).and_yield("stdout", "some message\n")</code></li>
</ul>


<h3><code>expect_any_instance_of</code></h3>

<ul>
<li>expect_any_instance_of(Object).to receive(:subscribe) <a href="http://stackoverflow.com/a/17577942/1496757">isn&#8217;t very well documented</a>, but <a href="http://rubydoc.info/gems/rspec-mocks/RSpec/Mocks/ExampleMethods:expect_any_instance_of">it&#8217;s in there</a>.</li>
</ul>


<h3>Testing Sidekiq</h3>

<ul>
<li><a href="https://github.com/mperham">Mike Perham</a> did a nice job documenting the <a href="https://github.com/mperham/sidekiq/wiki/Testing">testing options for workers</a>.

<h3>Detecting pending migrations</h3></li>
<li>A neat little trick to see if there are pending migrations <code>rake db:migrate:status</code>. This must have been built into rails because I see a message every time I haven&#8217;t run a migration and I am running my test suite. It&#8217;s cool nonetheless. <a href="http://stackoverflow.com/questions/1349047/show-pending-migrations-in-rails">Source</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/root-route-takes-parameters/">Root Route Takes Parameters</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2014-07-16T17:51:00-04:00" pubdate data-updated="true">Jul 16<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Looking for a hacky way to hard code your root path?</h3>

<p>Look no further: <code>root to: 'controller#action', hello_id: 1, finder_id: 1, laser_id: 1, sharks_id: 4</code> <a href="http://stackoverflow.com/a/22923920/1496757">via</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/stubbing-out-faraday/">Stubbing Out Faraday</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2014-07-15T11:49:00-04:00" pubdate data-updated="true">Jul 15<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Webmock to disable net connections</h3>

<ul>
<li><a href="https://github.com/bblimke/webmock#real-requests-to-network-can-be-allowed-or-disabled">Just toss it in the <code>spec_helper</code></a>

<ul>
<li><strong><em>Note</em></strong> that I had to use <code>WebMock.disable_net_connect!(:allow_localhost =&gt; true)</code> in the cucumber <code>support/env.rb</code> because my local host wasn&#8217;t being allowed to run on the ci. <a href="https://github.com/bblimke/webmock/issues/284">picked this up from issue #284 on webmocks</a></li>
</ul>
</li>
</ul>


<h3>Rspec Mocks</h3>

<ul>
<li>Can use the <a href="https://github.com/rspec/rspec-mocks#method-stubs">new syntax</a> or mocha.</li>
</ul>


<h3>To stub it out I could either</h3>

<figure class='code'><figcaption><span>These Both Work</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">before</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">allow</span><span class="p">(</span><span class="no">MyService</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:new</span><span class="p">)</span> <span class="p">{</span> <span class="n">double</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">before</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">allow_any_instance_of</span><span class="p">(</span><span class="no">MyService</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:publish</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Really cool. The <code>allow_any_instance_of()</code> is pretty sweet to reference an unnamed instance of a class. Pretty sweet.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/web-sockets-versus-nginx-push-state-versus-action-controller-live/">Web Sockets Versus Nginx Push State Versus Action_controller::live</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2014-07-02T17:52:00-04:00" pubdate data-updated="true">Jul 2<span>nd</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>The Decision</h2>

<h2>Nginx Push State</h2>

<p>https://gist.github.com/loganhasson/c8bfff2767ea74187cf0</p>

<h2>Enter Heroku</h2>

<p>Clearly keeping a threaded server open with the warning below is not ideal:</p>

<blockquote><p>Long-polling and streaming responses</p></blockquote>

<p>Cedar supports HTTP 1.1 features such as long-polling and streaming responses. An application has an initial 30 second window to respond with a single byte back to the client. However, each byte transmitted thereafter (either received from the client or sent by your application) resets a rolling 55 second window. If no data is sent during the 55 second window, the connection will be terminated.</p>

<p>If you’re sending a streaming response, such as with server-sent events, you’ll need to detect when the client has hung up, and make sure your app server closes the connection promptly. If the server keeps the connection open for 55 seconds without sending any data, you’ll see a request timeout.</p>

<ul>
<li>There are some solutions out there:

<ol>
<li><a href="http://stackoverflow.com/questions/17285961/http-streaming-connection-sse-client-disconnect-not-detected-with-sinatra-thin">Like</a></li>
<li><a href="https://gist.github.com/Funfun/6867167">Or</a></li>
</ol>
</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/presenter-objects/">Presenter Objects</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2014-06-17T18:49:00-04:00" pubdate data-updated="true">Jun 17<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>From our PR thread</h3>

<ul>
<li><p>A presenter object is a simply a PORO (plain ol&#8217; ruby object), constructed by the controller out of the data of one or more models, whose attributes serve the view
layer. So in our case we give a view a <code>LessonPresenter</code> that has a <code>css_class</code> attribute and remove all decision making from the view layer (which is the ideal goal).</p></li>
<li><p>It&#8217;s not a &#8220;service&#8221; object, it&#8217;s a presenter so it would go in the <code>presenters</code> folder. This is also sometimes called a &#8220;view model&#8221; or a &#8220;view object&#8221;. The word &#8220;presenter&#8221; is overloaded a lot.</p></li>
<li><p>This an interesting read on a few <a href="http://blog.codeclimate.com/blog/2012/10/17/7-ways-to-decompose-fat-activerecord-models/"><code>model refactoring patterns</code></a>:</p></li>
<li><p>So instead of a collection of Lessons at the view level, you&#8217;d be dealing with a collection of LessonPresenters or similar. Alternatively, you can just put that method on the lesson object itself, which is simpler and more straightforward but not strictly Single Responsibility Principle/Seperation of Concerns/Model View Controller compliant. tradeoffs.</p></li>
</ul>


<blockquote><p>Is it a terrible idea to have LessonPresenter inherit from Lesson?</p></blockquote>

<p>A: Strictly speaking in terms of OO, inheritance describes an &#8220;is-a&#8221; relationship, and you can&#8217;t say that a lessonpresenter is a lesson, so introducing an inheritance chain is probably inappropriate. There is some duplication to this pattern. Typically a viewmodel exposes only the attributes needed to satisfy the needs of the view, and you&#8217;d fill them in from the corresponding model on construction.</p>

<p>While this seems on the surface to violate DRY (and be duplicate work), i&#8217;d argue that it&#8217;s no more repetition than creating factories with the same attributes as models. Separate objects for separate purposes.</p>

<p>You could get away with hanging a lesson off of the presenter so that you could access it at the view level, but that&#8217;s a law of demeter violation and breaks encapsulation.</p>

<p>You could do the method_missing bit and delegate to the object. that&#8217;s slick and rubyish. Where that falls apart though is implementing this pattern across more than one model. Because we&#8217;re not really building a &#8220;presenter for a lesson&#8221;, we&#8217;re building a presentation object for a view that represents the model data behind it.</p>

<p>Already this answer is complicated, but there&#8217;s just always a lot of decisions that go into making architectural choices. It may be the case that for this one thing, creating a method on the Lesson itself is the &#8220;simplest thing that could possibly work&#8221; and satisfies one of our tenets of agile, and then we delay the big architectural choice until we need a second or third thing.</p>

<p>I support whichever choice you make (probably) as long as you have unit tests to support later refactoring :smile_cat:</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/5/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/3/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/my-take-on-maker-versus-manager/">My take on maker versus manager</a>
      </li>
    
      <li class="post">
        <a href="/blog/computer-science-according-to-spencer/">Computer Science according to Spencer</a>
      </li>
    
      <li class="post">
        <a href="/blog/quarterlies/">Quarterlies</a>
      </li>
    
      <li class="post">
        <a href="/blog/when-i-didnt-see-it-in-the-interview/">When I didn&#8217;t see it in the interview</a>
      </li>
    
      <li class="post">
        <a href="/blog/optical-distortion-inc-hbs-case-study/">Optical Distortion, Inc. HBS Case Study</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/adamjonas">@adamjonas</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'adamjonas',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Adam Jonas -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'ajonas';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
